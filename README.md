# Это проект бекенда приложения для управления миссиями ПА

### Использование в разработке

Эта команда создаст виртуальное окружение, скачает зависимости и запустит сервер.

`python3 -m venv venv && source ./venv/bin/activate \
&& pip install --no-cache-dir --upgrade -r ./requirements.txt \
&& uvicorn src.main:app --host 127.0.0.1 --port 9000`

После этого запускать можно так:

`uvicorn src.main:app --host 127.0.0.1 --port 9000`

### Собрать образ контейнера:

`docker build . -t hydro_web_interface:your_tag`

### Запустить внутри контейнера: 

`docker run -p 9000:9000 hydro_web_interface:your_tag`

### Документация API Swagger

После запуска приложения перейти http://127.0.0.1:9000/docs


### Какой код для чего

***В src/auth/ лежит код отвечающий за авторизацию***

Авторизация, сейчас просто представляет проверку параметров запроса.
Только один юзер может быть master(т.е.) управлять миссиями, а не только смотреть параметры.
Проверка, что юзер нужный происходит по имени, передаваемом в параметрах запроса.
Да, не очень. Это больше заглушка.
Но вроде как всё нормальные способы авторизации требуют хранить в бд какие-то данные о пользователях,
а мы делаем без бд.

UserControl в src/auth/user_control.py - класс, отвечающий за авторизацию пользователей.

В src/auth/router.py лежат эндпоинты связанные с авторизацией.

***В src/mission_control/ лежит код отвечающий за работу с миссиями***

В src/mission_control/repositories.py класс JsonRepository представляет собой json хранилище.  
Классы FrontJsonRepository и StateJsonRepository - классы для хранения полных
данных пришедших с фронта и текущего состояния миссии соответственно. 
По умолчанию данные хранится в папке data_storage/ (изменять в constants.py).
При старте программы вычитываются файлы "data_storage/front_data.json"
 и "data_storage/state.json". При завершение программы в эти файлы записывается
текущее состояние классов  FrontJsonRepository и StateJsonRepository

В src/mission_control/router.py лежат эндпоинты связанные с управлениями миссиями.
* init, update, start, stop, pause - управление состоянием.
* ws - получение параметров миссии

### Пример использования сервера
1. Делаем запрос на эндпоинт init/ (получили данные о миссиях)
2. Подключаемся к ws://0.0.0.0:9000/mc/ws (для получения обновлений о состоянии миссии) 
3. Делаем запрос /create_master/{my_username} (регистрируем master пользователя, чтобы иметь возможность управлять миссиями)
4. Изменяем миссиии и делаем /update?username=my_username (обновляем данные миссии)
5. Делаем запрос /start (стартуем миссиию)